### Запуск

```shell
kubectl create namespace order
helm install order . -n order
```

### Взаимодействие с приложением осуществляется через сервис Gateway.

#### Gateway предоставляет эндпоинты:

#### 1. POST register - регистрация пользователя

#### 2. POST login - логин пользователя с созданием JWT-токена и сохранением его в сессию и заголовки

#### 3. POST deposit - пополнение баланса пользователя

#### 4. POST withdraw - снятие средств со счета пользователя

#### 5. GET balance - проверка баланса пользователя

#### 6. POST orders - создание заказа

#### 7. GET messages - получение списка уведомлений о созданных заказах пользователя

Общая схема взаимодействия сервисов:

1. Пользователь регистрируется по адресу /register. Gateway проксирует запрос в сервис User. Пользователь создается в
   БД. <br>
2. Сервис User отправляет событие user.registered с данными пользователя.<br>
3. Сервис Billing читает топик user.registered и создает аккаунт пользователя.<br>
4. Пользователь логинится по адресу /login. Gateway проксирует запрос в сервис User. Пользователь авторизуется и
   создается JWT-токен.<br>
5. Пользователь пополняет баланс по адресу /deposit. Gateway проксирует запрос в сервис Billing.<br>
6. Пользователь создает заказ по адресу /orders. Gateway проксирует запрос в сервис Order.<br>
7. Сервис Order пытается снять деньги со счета пользователя, обращаясь в сервис Billing.<br>
8. Если средств хватает, то создается заказ и отправляется событие order.created со статусом success.<br>
9. Иначе средства возвращаются на счет, заказ не создается и отправляется событие order.created со статусом failed.<br>